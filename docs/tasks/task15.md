# Task 15: ãƒ›ãƒ¼ãƒ ç”»é¢å®Ÿè£…

## æ¦‚è¦
| é …ç›® | å†…å®¹ |
|------|------|
| ã‚¿ã‚¹ã‚¯ID | task15 |
| ãƒ•ã‚§ãƒ¼ã‚º | Phase 6: UIå®Ÿè£… |
| æ‰€è¦æ™‚é–“ | 2æ™‚é–“ |
| ä¾å­˜ã‚¿ã‚¹ã‚¯ | task12ï¼ˆãƒ¡ãƒˆãƒ­ãƒãƒ¼ãƒ ï¼‰, task13ï¼ˆãƒ—ãƒªã‚»ãƒƒãƒˆå–å¾—ï¼‰ |

## ç›®çš„
ãƒ¡ãƒˆãƒ­ãƒãƒ¼ãƒ ã®æ“ä½œã‚’è¡Œã†ãƒ¡ã‚¤ãƒ³ç”»é¢ã‚’å®Ÿè£…ã™ã‚‹ã€‚

## ç”»é¢ä»•æ§˜

### ãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ 
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Putt Tempo                    [âš™ï¸]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚     â”‚    ğŸŒï¸ ãƒ‘ã‚¿ãƒ¼æŒ¯ã‚Šå­     â”‚     â”‚  â† ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒšãƒ³ãƒ€ãƒ 
â”‚     â”‚      ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³      â”‚     â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                     â”‚
â”‚           85 BPM                    â”‚  â† BPMï¼ˆå¤§ããè¡¨ç¤ºï¼‰
â”‚           2 : 1                     â”‚  â† æ¯”ç‡
â”‚                                     â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚     â”‚  ğŸ“ ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰    â–¼  â”‚     â”‚  â† ãƒ—ãƒªã‚»ãƒƒãƒˆé¸æŠ
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                     â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚          â”‚     â–¶ï¸      â”‚            â”‚  â† å†ç”Ÿ/åœæ­¢ãƒœã‚¿ãƒ³
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                     â”‚
â”‚    [ğŸ”‡ ãƒã‚¤ãƒ–]     [ğŸ“³ éŸ³]         â”‚  â† å‡ºåŠ›åˆ‡ã‚Šæ›¿ãˆ
â”‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [åºƒå‘ŠãƒãƒŠãƒ¼]                       â”‚  â† ç„¡æ–™ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ      ğŸ“      ğŸ“Š      âš™ï¸        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å®Ÿè£…

### app/(tabs)/index.tsx
```typescript
// app/(tabs)/index.tsx

import { useState, useCallback } from 'react';
import { View, Text, Pressable } from 'react-native';
import { SafeAreaView } from 'react-native-safe-area-context';
import { router } from 'expo-router';
import { Ionicons } from '@expo/vector-icons';

import { Pendulum } from '@/components/Pendulum';
import { PlayButton } from '@/components/PlayButton';
import { PresetSelector } from '@/components/PresetSelector';
import { OutputModeToggle } from '@/components/OutputModeToggle';
import { BannerAd } from '@/components/ads/BannerAd';
import { useMetronomeSession } from '@/hooks/useMetronomeSession';
import { useAllPresets, usePreset } from '@/hooks/usePresets';
import { useAuth } from '@/contexts/AuthContext';
import { usePremiumStatus } from '@/hooks/usePurchase';
import { OutputMode, Preset } from '@/types';
import { DEFAULT_PRESETS } from '@/constants';

export default function HomeScreen() {
  const { user } = useAuth();
  const { isPremium } = usePremiumStatus();
  const { data: allPresets = [] } = useAllPresets();

  // é¸æŠä¸­ã®ãƒ—ãƒªã‚»ãƒƒãƒˆ
  const [selectedPresetId, setSelectedPresetId] = useState<string>(
    DEFAULT_PRESETS[0].id
  );
  const selectedPreset = usePreset(selectedPresetId) || DEFAULT_PRESETS[0];

  // å‡ºåŠ›ãƒ¢ãƒ¼ãƒ‰
  const [outputMode, setOutputMode] = useState<OutputMode>('sound');

  // ãƒ¡ãƒˆãƒ­ãƒãƒ¼ãƒ ã‚»ãƒƒã‚·ãƒ§ãƒ³
  const {
    isPlaying,
    currentPhase,
    toggleSession,
  } = useMetronomeSession(
    {
      bpm: selectedPreset.bpm,
      backRatio: selectedPreset.backRatio ?? selectedPreset.back_ratio,
      forwardRatio: selectedPreset.forwardRatio ?? selectedPreset.forward_ratio,
      soundType: selectedPreset.sound_type || 'click',
      isVibrationEnabled: outputMode === 'vibration' || outputMode === 'both',
    },
    selectedPreset.isDefault ? null : selectedPreset.id,
    selectedPreset.name,
    async (session) => {
      // ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†æ™‚ã«è¨˜éŒ²ã‚’ä¿å­˜
      if (session.durationSeconds >= 10) {
        // save_practice_session RPCå‘¼ã³å‡ºã—
      }
    }
  );

  // ãƒ—ãƒªã‚»ãƒƒãƒˆé¸æŠãƒ¢ãƒ¼ãƒ€ãƒ«
  const [isPresetModalVisible, setIsPresetModalVisible] = useState(false);

  const handlePresetSelect = useCallback((preset: Preset) => {
    setSelectedPresetId(preset.id);
    setIsPresetModalVisible(false);
  }, []);

  const handleTogglePlay = useCallback(() => {
    toggleSession();
  }, [toggleSession]);

  return (
    <SafeAreaView className="flex-1 bg-primary">
      {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
      <View className="flex-row items-center justify-between px-4 py-3">
        <Text className="text-white text-xl font-bold">Putt Tempo</Text>
        <Pressable
          onPress={() => router.push('/settings')}
          className="p-2"
        >
          <Ionicons name="settings-outline" size={24} color="#888888" />
        </Pressable>
      </View>

      {/* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
      <View className="flex-1 items-center justify-center px-4">
        {/* ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒšãƒ³ãƒ€ãƒ  */}
        <Pendulum
          isPlaying={isPlaying}
          currentPhase={currentPhase}
          bpm={selectedPreset.bpm}
          backRatio={selectedPreset.backRatio ?? selectedPreset.back_ratio}
          forwardRatio={selectedPreset.forwardRatio ?? selectedPreset.forward_ratio}
        />

        {/* BPMãƒ»æ¯”ç‡è¡¨ç¤º */}
        <View className="items-center my-6">
          <Text className="text-white text-5xl font-bold">
            {selectedPreset.bpm} BPM
          </Text>
          <Text className="text-gray-400 text-2xl mt-2">
            {selectedPreset.backRatio ?? selectedPreset.back_ratio} : {selectedPreset.forwardRatio ?? selectedPreset.forward_ratio}
          </Text>
        </View>

        {/* ãƒ—ãƒªã‚»ãƒƒãƒˆé¸æŠ */}
        <Pressable
          onPress={() => setIsPresetModalVisible(true)}
          className="bg-surface rounded-lg px-4 py-3 w-64 flex-row items-center justify-between"
        >
          <View className="flex-row items-center">
            <Ionicons name="folder-outline" size={20} color="#888888" />
            <Text className="text-white ml-2">{selectedPreset.name}</Text>
          </View>
          <Ionicons name="chevron-down" size={20} color="#888888" />
        </Pressable>

        {/* å†ç”Ÿ/åœæ­¢ãƒœã‚¿ãƒ³ */}
        <View className="my-8">
          <PlayButton
            isPlaying={isPlaying}
            onPress={handleTogglePlay}
          />
        </View>

        {/* å‡ºåŠ›ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ */}
        <OutputModeToggle
          mode={outputMode}
          onChange={setOutputMode}
        />
      </View>

      {/* åºƒå‘ŠãƒãƒŠãƒ¼ï¼ˆç„¡æ–™ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿ï¼‰ */}
      {!isPremium && <BannerAd />}

      {/* ãƒ—ãƒªã‚»ãƒƒãƒˆé¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« */}
      <PresetSelector
        visible={isPresetModalVisible}
        presets={allPresets}
        selectedId={selectedPresetId}
        onSelect={handlePresetSelect}
        onClose={() => setIsPresetModalVisible(false)}
      />
    </SafeAreaView>
  );
}
```

## ä½œæˆã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

1. **PlayButton** - å†ç”Ÿ/åœæ­¢ã®å¤§ããªãƒœã‚¿ãƒ³
2. **OutputModeToggle** - éŸ³/ãƒã‚¤ãƒ–åˆ‡æ›¿ãƒˆã‚°ãƒ«
3. **PresetSelector** - ãƒ—ãƒªã‚»ãƒƒãƒˆé¸æŠãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆãƒœãƒˆãƒ ã‚·ãƒ¼ãƒˆï¼‰

## å®Œäº†æ¡ä»¶
- [ ] ãƒ›ãƒ¼ãƒ ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒšãƒ³ãƒ€ãƒ ã‚¨ãƒªã‚¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼ˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¯task21ï¼‰
- [ ] BPMã¨æ¯”ç‡ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ãƒ—ãƒªã‚»ãƒƒãƒˆé¸æŠãŒå‹•ä½œã™ã‚‹
- [ ] å†ç”Ÿ/åœæ­¢ãƒœã‚¿ãƒ³ãŒå‹•ä½œã™ã‚‹
- [ ] å‡ºåŠ›ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ãŒå‹•ä½œã™ã‚‹
- [ ] ç„¡æ–™ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«åºƒå‘ŠãŒè¡¨ç¤ºã•ã‚Œã‚‹

## æ³¨æ„äº‹é …
- æŒ¯ã‚Šå­ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¯ task21 ã§å®Ÿè£…
- ç·´ç¿’è¨˜éŒ²ã®ä¿å­˜ã¯10ç§’ä»¥ä¸Šã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ã¿
